---
import Layout from '../layouts/Layout.astro';
import BastionBuilding from '../components/rules/bastions/BastionBuilding.astro';
import BastionEvents from '../components/rules/bastions/BastionEvents.astro';
import BastionRules from '../components/rules/bastions/BastionRules.astro';
import BastionUsage from '../components/rules/bastions/BastionUsage.astro';

const buildings = [
  {
    name: 'Арсенал',
    nameEn: 'Armory',
    level: 5,
    requirements: 'Нет',
    space: 2,
    hirelings: 1,
    order: 6,
    abilities: [
      {
        name: 'Торговать: вооружением',
        description: 'Когда вы отдаёте приказ торговать этому сооружению, вы поручаете наёмнику сооружения снабдить арсенал доспехами, щитами, оружием и боеприпасами. Это снаряжение стоит вам 100 зм + 100 зм за каждого защитника в вашем бастионе. Если в вашем бастионе есть кузница, то общая стоимость уменьшается вдвое.'
      },
      {
        name: '',
        description: 'Пока ваш арсенал заполнен, ваших защитников бастиона сложнее убить. Когда какое-либо событие заставляет вас бросить кости для определения потерь защитников вашего бастиона, бросайте к8 вместо каждого к6 для этого броска. Когда событие заканчивается, снаряжение в вашем арсенале расходуется вне зависимости от того, сколько у вас защитников бастиона или сколько вы потеряли, оставляя ваш арсенал пустым до тех пор, пока вы не отдадите ещё один приказ торговать этому сооружению и не оплатите стоимость его пополнения.'
      }
    ]
  },
  {
    name: 'Барак',
    nameEn: 'Barrack',
    level: 5,
    requirements: 'Нет',
    space: 4,
    hirelings: 1,
    order: 5,
    description: 'В бастионе может быть несколько бараков, каждый из которых обустроен так, чтобы служить спальными помещениями для 12 защитников бастиона.',
    abilities: [
      {
        name: 'Завербовать: защитников бастиона',
        description: 'Каждый раз, когда вы отдаёте приказ завербовать этому сооружению, до 4 защитников бастиона вербуются в ваш бастион и размещаются в этом бараке. Найм не стоит денег. Вы не можете отдать приказ о найме в это сооружение, если оно полностью заполнено. Следите за защитниками бастиона, размещёнными в каждом из ваших бараков. Если вы теряете защитников бастиона, то уменьшите количество защитников в своём листе бастиона. Назначайте имена и личности вашим защитникам бастиона по своему усмотрению.'
      },
      {
        name: 'Расширение сооружения',
        description: 'Вы можете расширить свой барак до просторного сооружения, потратив 2000 зм. Просторный барак может вместить до 25 защитников бастиона.'
      }
    ]
  },
  {
    name: 'Библиотека',
    nameEn: 'Library',
    level: 5,
    requirements: 'Нет',
    space: 2,
    hirelings: 1,
    order: 6,
    description: 'В этой библиотеке имеется коллекция книг, а также один или несколько столов и стульев для чтения.',
    abilities: [
      {
        name: 'Изучать: тематические знания',
        description: 'Когда вы отдаёте приказ изучать этому сооружению, вы поручаете наёмнику сооружения исследовать тему. Темой может быть легенда, известное событие или место, значимая персона, тип существа или известный объект. Работа занимает 7 дней. Когда исследование завершается, наёмник получает до трёх точных фрагментов информации по теме, которые ранее были вам неизвестны, и делится этими знаниями с вами в следующий раз, когда вы с ним поговорите. Мастер определяет, какую информацию вы узнаёте.'
      }
    ]
  },
  {
    name: 'Кабинет заклинателя',
    nameEn: 'Arcane Study',
    level: 5,
    requirements: 'Умение использовать заклинательную фокусировку или инструмент в качестве неё',
    space: 2,
    hirelings: 1,
    order: 1,
    description: 'Кабинет заклинателя — это место для тихого исследования, в котором имеется один или несколько столов и книжных полок.',
    abilities: [
      {
        name: 'Чары кабинета заклинателя',
        description: 'Проведя продолжительный отдых в своём бастионе, вы получаете магические чары (см. Сверхъестественные дары в главе 3), которые действуют в течение 7 дней или пока вы их не используете. Чары позволяют вам использовать заклинание Опознание, без траты ячейки заклинания и/или материального компонента. Вы не можете получить эти чары снова, пока они у вас есть.'
      },
      {
        name: 'Варианты изготовления',
        description: 'Когда вы отдаёте приказ изготовить этому сооружении, выберите один из следующих вариантов:'
      },
      {
        name: 'Изготовить: заклинательную фокусировку',
        description: 'Вы поручаете наёмнику сооружения изготовить заклинательную фокусировку. Работа занимает 7 дней и не стоит денег. Заклинательная фокусировка остаётся в вашем бастионе, пока вы её не заберёте.'
      },
      {
        name: 'Изготовить: книгу',
        description: 'Вы поручаете наёмнику сооружения изготовить пустую книгу. Работа занимает 7 дней и обойдётся вам в 10 зм. Книга останется в вашем бастионе, пока вы её не заберёте.'
      },
      {
        name: 'Изготовить: магический предмет (Магия)',
        description: 'Если вы достигли 9 уровня, то вы можете поручить наёмнику сооружения изготовить обычный или необычный магический предмет, выбранный вами из таблиц «Магия» главе 7. В кабинете есть инструмент, необходимый для изготовления предмета, а наёмник владеет этим инструментом, а также навыком Аркана. См. раздел Создание магических предметов главе 7, чтобы узнать время и деньги, которые необходимо потратить на изготовление предмета. Если предмет позволяет своему пользователю накладывать какие-либо заклинания, то вы должны изготовить предмет самостоятельно (наёмник сооружения может помочь), и вы должны иметь подготовленными все эти заклинания каждый день, который вы тратите на создание предмета.'
      }
    ]
  },
  {
    name: 'Кузница',
    nameEn: 'Smithy',
    level: 5,
    requirements: 'Нет',
    space: 2,
    hirelings: 2,
    order: 1,
    description: 'В этой кузнице есть горн, наковальня и другие инструменты, необходимые для изготовления оружия, доспехов и другого снаряжения.',
    abilities: [
      {
        name: 'Варианты изготовления',
        description: 'Когда вы отдаёте приказ изготовить этому сооружению, выберите один из следующих вариантов:'
      },
      {
        name: 'Изготовить: инструменты кузнеца',
        description: 'Наёмники сооружения изготавливают любой предмет, который можно создать с помощью инструментов кузнеца, используя правила из Книги игрока Книги игрока.'
      },
      {
        name: 'Изготовить: магический предмет (оружие)',
        description: 'Если вы достигли 9 уровня, то вы можете поручить наёмникам сооружения создать обычный или необычный магический предмет, выбранный вами из таблиц «Вооружение» главе 7. В сооружении есть инструмент, необходимый для создания предмета, а наёмники владеют этим инструментом и навыком Аркана. См. раздел Создание магических предметов в главе 7, чтобы узнать время и деньги, которые необходимо потратить на создание предмета. Если предмет позволяет своему пользователю накладывать какие-либо заклинания, то вы должны создать предмет самостоятельно (наёмники сооружения могут помочь), и вы должны иметь подготовленными все эти заклинания каждый день, который вы тратите на создание предмета.'
      }
    ]
  },
  {
    name: 'Мастерская',
    nameEn: 'Workshop',
    level: 5,
    requirements: 'Нет',
    space: 2,
    hirelings: 3,
    order: 1,
    description: 'Эта мастерская представляет собой творческое пространство, где можно создать полезные предметы.',
    abilities: [
      {
        name: 'Инструменты ремесленника',
        description: 'Мастерская оснащена шестью различными видами инструментов ремесленника, выбранными из следующего списка: инструменты гончара, инструменты каменщика, инструменты кожевника, инструменты плотника, инструменты резчика по дереву, инструменты ремонтника, инструменты сапожника, инструменты стеклодува, инструменты ткача, инструменты художника, инструменты ювелира.'
      },
      {
        name: 'Варианты изготовления',
        description: 'Когда вы отдаёте приказ изготовить этому сооружению, выберите один из следующих вариантов:'
      },
      {
        name: 'Изготовить: снаряжение для приключений',
        description: 'Наёмники сооружения изготавливают любой предмет, который можно создать с помощью выбранных инструментов (см. выше), используя правила из Книги игрока.'
      },
      {
        name: 'Изготовить: магический предмет (вооружение)',
        description: 'Если вы достигли 9 уровня, то вы можете по- ручить наёмникам сооружения изготовить обычный или необычный магический предмет, выбранный вами из таблиц «Вооружение» в главе 7. В сооружении есть инструмент, необходимый для создания предмета, а наёмники владеют этим инструментом, а также навыком Аркана. См. раздел Создание магических предметов в главе 7, чтобы узнать время и деньги, которые необходимо потратить на создание предмета. Если предмет позволяет своему пользователю накладывать какие-либо заклинания, то вы должны создать предмет самостоятельно (наёмники сооружения могут помочь), и вы должны иметь подготовленными все эти заклинания каждый день, который вы тратите на создание предмета.'
      },
      {
        name: 'Источник вдохновения',
        description: 'Проведя короткий отдых в своей мастерской, вы получаете героическое вдохновение. Вы не сможете получить этот эффект снова, пока не закончите продолжительный отдых.'
      },
      {
        name: 'Расширение сооружения',
        description: 'Вы можете расширить пространство своей мастерской до просторного, потратив 2000 зм. Если вы это сделаете, то мастерская получит 2 дополнительных наёмников и 3 дополнительных инструмента ремесленника (выбранных из списка выше).'
      }
    ]
  },
  {
    name: 'Сад',
    nameEn: 'Garden',
    level: 5,
    requirements: 'Нет',
    space: 4,
    hirelings: 1,
    order: 1,
    description: 'Бастион может иметь более одного сада. Каждый раз, когда вы добавляете сад к своему бастиону, выбирайте его тип из вариантов в таблице «Типы садов».',
    abilities: [
      {
        name: '',
        description: 'Находясь в бастионе, вы можете поручить наёмнику объекта изменить тип cада. Эта работа занимает 21 день, в течение которых никакая другая деятельность не может происходить в этом сооружении.'
      },
      {
        name: 'Собирать: урожай из сада',
        description: 'Когда вы отдаёте приказ собирать этому сооружению, вы поручаете наёмнику сооружения собрать урожай из сада, как указано в таблице «Типы садов». Работа занимает 7 дней и не стоит денег.'
      },
      {
        name: 'Расширение объекта',
        description: 'Вы можете расширить пространство своего сада до просторного, потратив 2000 зм. Просторный сад эквивалентен двум вместительным садам и может включать 2 сада одного или разных типов. Когда вы отдаёте приказ собирать для просторного сада, каждый из двух садов производит свой собственный урожай. Просторный сад получает 1 дополнительного наёмника, который обслуживает второй сад.'
      }
    ]
  },
  {
    name: 'Святилище',
    nameEn: 'Sanctuary',
    level: 5,
    requirements: 'Умение использовать священный символ или фокусировку друида в качестве заклинательной фокусировки',
    space: 2,
    hirelings: 1,
    order: 1,
    abilities: [
      {
        name: 'Чары святилища',
        description: 'Проведя продолжительный отдых в своём бастионе, вы получаете магические чары (см. Сверхъестественные дары в главе 3), которые действуют в течение 7 дней или пока вы их не используете. Чары позволяют вам один раз наложить заклинание Лечащее слово без траты ячейки заклинания. Вы не можете получить эти чары снова, пока они у вас есть.'
      },
      {
        name: 'Изготовить: священную фокусировку',
        description: 'Когда вы отдаёте приказ изготовить этому сооружению, вы поручаете наёмнику сооружения изготовить фокусировку друида (деревянный посох) или священный символ. Работа занимает 7 дней и не стоит денег. Предмет остаётся в вашем бастионе, пока вы его не заберёте.'
      }
    ]
  },
  {
    name: 'Склад',
    nameEn: 'Storehouse',
    level: 5,
    requirements: 'Нет',
    space: 2,
    hirelings: 1,
    order: 7,
    description: 'Склад — это прохладное, тёмное помещение для хранения предметов торговли из таблицы Товары торговли в главе 7 и из главы 6 Книги игрока.',
    abilities: [
      {
        name: 'Торговать: товарами',
        description: 'Когда вы отдаёте приказ торговать этому сооружению, его наёмник тратит следующие 7 дней на закупку немагических предметов общей стоимостью 500 зм или меньше и хранит их на складе, либо наёмник использует эти 7 дней для продажи товаров на складе. Вы оплачиваете любые покупки. Максимальная стоимость приобретённых предметов увеличивается до 2000 зм, когда вы достигаете 9 уровня, и до 5000 зм, когда вы достигаете 13 уровня.'
      },
      {
        name: '',
        description: 'Когда вы продаёте товары со своего склада, покупатель платит вам на 10% больше стандартной цены, эта прибыль увеличивается до 20%, когда вы достигаете 9 уровня, до 50%, когда вы достигаете 13 уровня, и до 100%, когда вы достигаете 17 уровня.'
      }
    ]
  },
  {
    name: 'Игорное заведение',
    nameEn: 'Gaming Hall',
    level: 9,
    requirements: 'Нет',
    space: 3,
    hirelings: 4,
    order: 7,
    description: 'Игровой зал предлагает развлекательные мероприятия, такие как шахматы, дартс, карты или кости.',
    abilities: [
      {
        name: 'Торговать: фишками',
        description: 'Когда вы отдаёте приказ торговать этому сооружению, наёмники заведения превращают игорное заведение в игорный дом на 7 дней. В конце седьмого дня бросьте 1к100 и сверьтесь со следующей таблицей, чтобы определить (свою) долю выигрыша дома.'
      }
    ]
  },
  {
    name: 'Канцелярия',
    nameEn: 'Scriptorium',
    level: 9,
    requirements: 'Нет',
    space: 2,
    hirelings: 1,
    order: 1,
    description: 'В канцелярии имеются столы и письменные принадлежности.',
    abilities: [
      {
        name: 'Варианты изготовления',
        description: 'Когда вы отдаёте приказ изготовить этому сооружению, выберите один из следующих вариантов:'
      },
      {
        name: 'Изготовить: копию книги',
        description: 'Вы поручаете наёмнику сооружения сделать копию немагической книги. Для этого потребуется чистая книга. Работа занимает 7 дней.'
      },
      {
        name: 'Изготовить: свиток заклинания',
        description: 'Вы поручаете наёмнику сооружения изготовить Свиток заклинания, содержащий 1 заклинание жреца или волшебника уровня 3 или ниже. В сооружении есть необходимые инструменты каллиграфа, а наёмник соответствует всем требованиям, необходимым для написания свитка. Раздел «Создание снаряжения» в Книге игрока указывает время для написания свитка и стоимость свитка, которую вы должны заплатить.'
      },
      {
        name: 'Изготовить: копии документа',
        description: 'Вы поручиаете наёмнику сооружения создать до 50 копий плаката, буклета или иного бумажного изделия с отдельными листами. Работа занимает 7 дней и стоит 1 зм за копию. Без дополнительных затрат времени или денег наёмник учреждения может распространить документы в одном или нескольких местах в радиусе 50 миль (80,5 километров) от вашего бастиона.'
      }
    ]
  },
  {
    name: 'Комната трофеев',
    nameEn: 'Trophy Room',
    level: 9,
    requirements: 'Нет',
    space: 2,
    hirelings: 1,
    order: 6,
    description: 'В этой комнате хранится коллекция памятных вещей, таких как оружие старых сражений, головы убитых существ, безделушки, найденные в подземельях и руинах, а также трофеи, переданные по наследству предками.',
    abilities: [
      {
        name: 'Варианты исследований',
        description: 'Когда вы отдаёте приказ изучать этому сооружению, выберите один из следующих вариантов:'
      },
      {
        name: 'Изучать: знания',
        description: 'Вы поручаете наёмнику сооружения исследовать тему по вашему выбору. Темой может быть легенда, любое существо или известный объект. Тема не обязательно должна быть напрямую связана с предметами, выставленными в комнате, так как трофеи дают подсказки для исследования широкого спектра других предметов. Работа занимает 7 дней. Когда исследование завершается, наёмник получает до трёх точных фрагментов информации по теме, которые ранее были вам неизвестны, и делится этими знаниями с вами в следующий раз, когда вы с ним поговорите. Мастер определяет, какая информация будет изучена.'
      },
      {
        name: 'Изучать: трофей-безделушку',
        description: 'Вы поручаете наёмнику сооружения найти безделушку, которая может вам пригодиться. Работа занимает 7 дней. Когда исследование завершится, бросьте любую кость. Если выпавшее число нечётное, то наёмник не найдёт ничего полезного. Если выпавшее число чётное, то наёмник найдёт магический предмет. Совершите бросок по общей таблице «Вооружение» в главе 7, чтобы определить, что это.'
      }
    ]
  },
  {
    name: 'Конюшня',
    nameEn: 'Stable',
    level: 9,
    requirements: 'Нет',
    space: 4,
    hirelings: 1,
    order: 7,
    description: 'В бастионе может быть более одной конюшни. В каждой конюшне, которую вы добавляете в свой бастион, есть 1 ездовая лошадь или верблюд и 2 пони или мула, смотрите Книгу Игрока или Бестиарий для статблоков этих существ. Помещение достаточно большое, чтобы вместить 3 больших животных. 2 средних существа занимают там столько же места, как 1 большое существо. Наёмник сооружения присматривает за этими существами. После того, как верховое животное, проведёт в этом сооружении не менее 14 дней, все проверки Мудрости (Уход за животными) в отношении него совершаются с преимуществом.',
    abilities: [
      {
        name: 'Торговать: животными',
        description: 'Когда вы отдаёте приказ торговать этому сооружению, вы поручаете наёмнику учреждения купить или продать одно или несколько верховых животных по обычной стоимости, оставляя купленных вами в вашей конюшне. Работа занимает 7 дней, и Мастер решает, какие типы животных доступны для покупки — лошади, пони и мулы являются наиболее распространёнными. Таблица «Верховые и прочие животные» в Книге игрока даёт стандартные цены на различных верховых животных. Вы платитполную стоимость любых покупок.'
      },
      {
        name: 'Изучать: знания',
        description: 'Когда вы продаёте верховое животное из своей конюшни, покупатель платит вам на 20% больше стандартной цены; эта прибыль увеличивается до 50%, когда вы достигаете 13 уровня, и до 100%, когда вы достигаете 17 уровня.'
      },
      {
        name: 'Расширение объекта',
        description: 'Вы можете расширить пространство своей конюшни до просторного, потратив 2000 зм. Если вы это сделаете, то конюшня будет достаточно большой, чтобы вместить 6 больших животных.'
      }
    ]
  },
  {
    name: 'Круг телепортации',
    nameEn: 'Teleportation Circle',
    level: 9,
    requirements: 'Нет',
    space: 2,
    hirelings: 1,
    order: 5,
    description: 'На полу этой комнаты начечен постоянный круг телепортации заклинания Круг телепортации.',
    abilities: [
      {
        name: 'Завербовать: заклинателя',
        description: 'Каждый раз, когда вы отдаёте приказ завербовать этому сооружению, его наёмник направляет приглашение дружественному заклинателю ПМ. Бросьте любую кость. Если выпавшее число нечётное, то он отклоняет приглашение, и вы не получаете никакого эффекта от приказа. Если выпавшее число чётное, то он принимает приглашение и прибывает в ваш бастион через ваш круг телепортации.'
      },
      {
        name: '',
        description: 'Пока вы находитесь в своем бастионе, вы можете попросить заклинателя наложить 1 заклинание волшебника уровня 4 или ниже; если ваш уровень 17+, максимальный уровень заклинания увеличивается до 8. Предполагается, что заклинатель подготовил заклинание. Если заклинание содержит 1 или несколько материальных компонентов, которые стоят денег, то вы должны оплатить их, прежде чем заклинание можно будет наложить.'
      },
      {
        name: '',
        description: 'Заклинатель остаётся на 14 дней или пока не наложит заклинание на вас. Заклинатель не будет защищать ваш бастион и немедленно уйдёт, если на бастион нападут (см. События бастиона в конце главы).'
      }
    ]
  },
  {
    name: 'Лаборатория',
    nameEn: 'Laboratory',
    level: 9,
    requirements: 'Нет',
    space: 2,
    hirelings: 1,
    order: 1,
    description: 'Лаборатория содержит складские помещения для алхимических принадлежностей и рабочие зоны для приготовления различных смесей.',
    abilities: [
      {
        name: 'Варианты изготовления',
        description: 'Когда вы отдаёте приказ изготовить в этом сооружении, выберите один из следующих вариантов:'
      },
      {
        name: 'Изготовить: из инструментов алхимика',
        description: 'Наёмники сооружения изготавливают любой предмет, который можно создать с помощью инструментов алхимика, используя правила из Книги игрока и главы 7 этой книги.'
      },
      {
        name: 'Изготовить: яд',
        description: 'Вы поручаете наёмнику сооружения изготовить флакон с одним применением яда. Яд должен быть одним из следующих: Дым жжённого отура, Эссенция эфира или Ступор. См. Яды в главе 3 для получения информации об эффекте каждого яда. Эта работа занимает 7 дней, и вы должны заплатить половину стоимости яда.'
      }
    ]
  },
  {
    name: 'Ризница',
    nameEn: 'Sacristy',
    level: 9,
    requirements: 'Умение использовать священный символ или фокусировку друида в качестве заклинательной фокусировки',
    space: 2,
    hirelings: 1,
    order: 1,
    description: 'Ризница служит помещением для подготовки и хранения священных предметов и церковных облачений.',
    abilities: [
      {
        name: 'Варианты изготовления',
        description: 'Когда вы отдаёте приказ изготовить в этом сооружении, выберите один из следующих вариантов:'
      },
      {
        name: 'Изготовить: святую воду',
        description: 'Вы поручаете наёмнику сооружения изготовить флягу святой воды. Работа занимает 7 дней и не стоит денег. Вы можете потратить зм в процессе создания, чтобы увеличить силу святой воды. За каждые потраченные 100 зм, вплоть до максимума в 500 зм, урон, наносимый святой водой, увеличивается на 1к8.'
      },
      {
        name: 'Изготовить: магический предмет (реликвия)',
        description: 'Вы поручаете наёмнику сооружения создать обычный или необычный магический предмет, выбранный вами из таблицы «Реликвии» в главе 7. В сооружении есть инструмент, необходимый для создания предмета, и наёмник владеет этим инструментом, а также владеет навыком Аркана. См. раздел Создание магических предметов в главе 7, чтобы узнать время и деньги, которые необходимо потратить на создание предмета. Если предмет позволяет своему пользователю накладывать какие-либо заклинания, то вы должны создать предмет самостоятельно (наёмники сооружения могут помочь), и вы должны иметь подготовленными все эти заклинания каждый день, который вы тратите на создание предмета.'
      },
      {
        name: 'Восстановление заклинаний',
        description: 'Наличие ризницы позволяет вам восстановить одну использованную ячейку заклинания 5 уровня или ниже после того, как вы провели весь короткий отдых в вашем бастионе. Вы не сможете получить этот эффект снова, пока не закончите продолжительный отдых.'
      }
    ]
  },
  {
    name: 'Театр',
    nameEn: 'Theater',
    level: 9,
    requirements: 'Нет',
    space: 4,
    hirelings: 4,
    order: 2,
    description: 'Театр состоит из сцены, закулисной зоны, где хранятся реквизит и декорации, а также зоны отдыха для небольшой аудитории.',
    abilities: [
      {
        name: 'Усилить: театральное мероприятие',
        description: 'Когда вы отдаёте приказ усилить этому сооружению, его наёмники начинают работу над театральной постановкой или концертом. Репетиции и другие приготовления занимают 14 дней, за которыми следует не менее 7 дней представлений. Представления могут продолжаться бесконечно, пока не будет отдан новый приказ. Вы или другой персонаж можете внести свой вклад в постановку следующими способами:'
      },
      {
        name: 'Дирижёр/режиссёр',
        description: 'Персонаж, который остаётся в бастионе на протяжении всего спектакля, может выступать в качестве дирижёра концерта или режиссёра спектакля.'
      },
      {
        name: 'Исполнитель',
        description: 'Персонаж, который остаётся в бастионе на весь репетиционный период, может быть звёздным исполнителем в одном или нескольких спектаклях; один из наёмников театра может выступать в качестве дублёра для дополнительных спектаклей.'
      },
      {
        name: '',
        description: 'В конце периода репетиций каждый персонаж, который внёс вклад в концерт или постановку, может совершить проверку Харизмы (Исполнение) со Сл. 15. Если среди этих проверок успехов больше, чем неудач, то вы и любой другой персонаж, который внёс вклад в концерт или постановку, получаете по кости театра, к6. Эта кость меняется на к8, когда вы достигаете 13 уровня, и на к10, когда вы достигаете 17 уровня. В любой момент после окончания репетиций персонаж может потратить свою кость театра, чтобы бросить его и добавить выпавшее число к одному своему броску Теста к20, сразу после броска к20. Если персонаж не потратил свою кость театра, прежде чем получить другую, его первая кость исчезает.'
      }
    ]
  },
  {
    name: 'Теплица',
    nameEn: 'Greenhouse',
    level: 9,
    requirements: 'Нет',
    space: 2,
    hirelings: 1,
    order: 3,
    description: 'Теплица — это помещение, где в контролируемом климате выращиваются редкие растения и грибы.',
    abilities: [
      {
        name: 'Фрукты восстановления',
        description: 'На одном растении в вашей теплице растут 3 магических плода. Любое существо, съедающее один из этих плодов, получает эффект заклинания Малое восстановление Малое восстановление. Фрукты, которые не съедены в течение 24 часов после сбора, теряют свою магию. Растение заменяет все собранные фрукты ежедневно на рассвете, и его нельзя пересадить, не убив.'
      },
      {
        name: 'Варианты собирания',
        description: 'Когда вы отдаёте приказ собирать этому сооружению, выберите один из следующих вариантов:'
      },
      {
        name: 'Собирать: целебные травы',
        description: 'Вы поручаете наёмнику сооружения создать Зелье лечения (большое) из целебных трав. Работа занимает 7 дней и не стоит денег.'
      },
      {
        name: 'Собирать: ядовитые растения',
        description: 'Вы поручаете наёмнику сооружения извлечь 1 дозу яда из редких растений или грибов. Выберите тип яда из следующих вариантов: Кровь ассасина, Злоба, Бледная настойка или Сыворотка правды. См. Яды в главе 3 для получения информации об эффекте каждого яда. После сбора яд можно поместить во флакон. Работа занимает 7 дней и не стоит денег.'
      }
    ]
  },
  {
    name: 'Теплица',
    nameEn: 'Greenhouse',
    level: 9,
    requirements: 'Нет',
    space: 2,
    hirelings: 1,
    order: 3,
    description: 'Теплица — это помещение, где в контролируемом климате выращиваются редкие растения и грибы.',
    abilities: [
      {
        name: 'Фрукты восстановления',
        description: 'На одном растении в вашей теплице растут 3 магических плода. Любое существо, съедающее один из этих плодов, получает эффект заклинания Малое восстановление Малое восстановление. Фрукты, которые не съедены в течение 24 часов после сбора, теряют свою магию. Растение заменяет все собранные фрукты ежедневно на рассвете, и его нельзя пересадить, не убив.'
      },
      {
        name: 'Варианты собирания',
        description: 'Когда вы отдаёте приказ собирать этому сооружению, выберите один из следующих вариантов:'
      },
      {
        name: 'Собирать: целебные травы',
        description: 'Вы поручаете наёмнику сооружения создать Зелье лечения (большое) из целебных трав. Работа занимает 7 дней и не стоит денег.'
      },
      {
        name: 'Собирать: ядовитые растения',
        description: 'Вы поручаете наёмнику сооружения извлечь 1 дозу яда из редких растений или грибов. Выберите тип яда из следующих вариантов: Кровь ассасина, Злоба, Бледная настойка или Сыворотка правды. См. Яды в главе 3 для получения информации об эффекте каждого яда. После сбора яд можно поместить во флакон. Работа занимает 7 дней и не стоит денег.'
      }
    ]
  },
  {
    name: 'Тренировочная зона',
    nameEn: 'Training Area',
    level: 9,
    requirements: 'Нет',
    space: 4,
    hirelings: 4,
    order: 2,
    description: 'Бастион может иметь более одной тренировочной зоны. Тренировочная зона может быть внутренним двором, гимнастическим залом или хитроумно построенной полосой препятствий. Она может содержать мишени, манекены (для тренировки с оружием), мягкие маты и другое оборудование. Один из наёмников сооружения является опытным мастером; остальные служат партнёрами в спаррингах и тренировках.',
    abilities: [
      {
        name: '',
        description: 'Когда тренировочная зона становится частью вашего бастиона, выберите одного мастера из таблицы «Мастера». В каждый ход бастиона вы можете заменить этого мастера другим из таблицы.'
      },
      {
        name: 'Усилить: обучение',
        description: 'Когда вы отдаёте приказ усилить этому сооружению, наёмники сооружения проводят тренировки в течение следующих 7 дней. Любой персонаж, который тренируется здесь не менее 8 часов в каждый из этих дней, получает эффект в конце периода обучения. Эффект зависит от того, какой мастер присутствует в сооружении, как указано в таблице «Мастера». Эффект длится 7 дней.'
      }
    ]
  },
  {
    name: 'Архив',
    nameEn: 'Архив',
    level: 13,
    requirements: 'Нет',
    space: 4,
    hirelings: 4,
    order: 2,
    description: 'Архив — хранилище ценных книг, карт и свитков. Обычно проход к нему ведёт через библиотеку за запертой или секретной дверью.',
    abilities: [
      {
        name: 'Изучать: полезные знания',
        description: 'Когда вы отдаёте приказ изучать этому сооружению, вы поручаете наёмнику сооружения искать в архиве полезные знания. Работа занимает 7 дней. Наёмник получает знания, как если бы он наложил заклинание Знание легенд, а затем делится этими знаниями с вами в следующий раз, когда вы с ним поговорите.'
      },
      {
        name: 'Справочник',
        description: 'Ваш архив содержит 1 экземпляр редкого и ценного справочника, который даёт вам преимущество, пока вы и справочник находитесь в вашем бастионе. Вы можете выбрать один из следующих вариантов (ваш Мастер может сделать больше вариантов):'
      },
      {
        name: 'Удобный кодекс магии от Бигби',
        description: 'Вы получаете преимущество на любую проверку Интеллекта (Аркана), которую вы совершаете действием изучение, чтобы вспомнить знания о заклинаниях, магических предметах, древних символах, магических традициях и планах.'
      },
      {
        name: 'Хроники Хронепсиса',
        description: 'Вы получаете преимущество на любую проверку Интеллекта (Истории), когда вы совершаете действием изучение, чтобы вспомнить знания об исторических событиях, легендарных людях, древних королевствах, диспутах прошлого, войнах и затерянных цивилизациях.'
      },
      {
        name: 'Расследования сыщика',
        description: 'Вы получаете преимущество на любую проверку Интеллекта (Анализ), которую вы совершаете действием изучение, чтобы сделать выводы на основе улик или доказательств, либо вспомнить знания о ловушках, шифрах, загадках и устройствах.'
      },
      {
        name: 'Материальные размышления о природе мира',
        description: 'Вы получаете преимущество на любую проверку Интеллекта (Природа), когда вы выполняете действие изучение, чтобы вспомнить знания о местности, растениях, животных и погоде.'
      },
      {
        name: 'Старая вера и другие религии',
        description: 'Вы получаете преимущество на любую проверку Интеллекта (Религия), когда совершаете действие изучение, чтобы вспомнить знания о божествах, обрядах, молитвах, иерархиях, священных символах и практиках тайных культов.'
      },
      {
        name: 'Расширение объекта',
        description: 'Вы можете расширить пространство своего архива до просторного, потратив 2000 зм. Если вы это сделаете, то архив получит 2 дополнительных справочника из списка выше.'
      }
    ]
  },
  {
    name: 'Комната для медитации',
    nameEn: 'Meditation Chamber',
    level: 13,
    requirements: 'Нет',
    space: 1,
    hirelings: 1,
    order: 2,
    description: 'Комната для медитации — это уединённое место, помогающее держать в гармонии разум, тело и дух.',
    abilities: [
      {
        name: 'Усилить: внутренний покой',
        description: 'Когда вы отдаёте приказ усилить этому сооружению, наёмники вашего бастиона могут использовать комнату для медитации, чтобы обрести меру внутреннего покоя. В следующий раз, когда вы будете совершать бросок для события бастиона, вы можете бросить дважды и выбрать любой результат.'
      },
      {
        name: 'Укрепить себя',
        description: 'Вы можете медитировать в этом сооружении в течение 7 дней. Если вы покинете бастион в это время, вы не получите никакого эффекта. Если вы соблюдаете медитацию в течении 7 дней, то в конце седьмого дня, вы получите преимущество на два типа спасброска в течение следующих 7 дней. Типы спасброска определяются броском по таблице ниже. Перебросьте, если вы получите дублирующий результат.'
      }
    ]
  },
  {
    name: 'Обсерватория',
    nameEn: 'Observatory',
    level: 13,
    requirements: 'Умение использовать заклинательную фокусировку',
    space: 2,
    hirelings: 1,
    order: 2,
    description: 'На вершине вашего бастиона расположена обсерватория с телескопом, направленным на ночное небо.',
    abilities: [
      {
        name: 'Чары обсерватории',
        description: 'Вы можете использовать свою обсерваторию, чтобы заглянуть в дальние уголки Дикого космоса и Астрального плана Астрального плана. Проведя продолжительный отдых в своей обсерватории, вы получаете магические чары (см. Сверхъестественные Дары в главе 3), которые действуют в течение 7 дней или до тех пор, пока вы их не используете. Чары позволяют вам наложить заклинание Связь с иным планом без траты ячейки заклинания. Вы не можете получить эти чары снова, пока они у вас есть.'
      },
      {
        name: 'Усилить: сверхъестественное открытие',
        description: 'Когда вы отдаёте приказ усилить этому сооружению, вы позволяете себе или наёмнику сооружения исследовать сверхъестественные тайны звёзд в течение 7 ночей подряд. По истечении этого времени бросьте кость. Если выпавшее число чётное, то ничего не происходит. Если выпавшее число нечётное, то неизвестная сила дарует вам или другому существу по вашему выбору, находящемуся на том же плане, что и вы, одну из следующих чар: Чары тёмного зрения, Чары героизма или Чары живучести (все они описаны в разделе Сверхъестественные Дары в главе 3).'
      }
    ]
  },
  {
    name: 'Реликварий',
    nameEn: 'Reliquary',
    level: 13,
    requirements: 'Умение использовать священный символ или фокусировку друида в качестве заклинательной фокусировки',
    space: 1,
    hirelings: 1,
    order: 3,
    description: 'В этом хранилище хранятся священные предметы.',
    abilities: [
      {
        name: 'Чары реликвария',
        description: 'Проведя продолжительный отдых в своем бастионе, вы получаете магические чары (см. Сверхъестественные дары в главе 3), которые действуют в течение 7 дней или пока вы их не используете. Чары позволяют вам один раз наложить заклинание Высшее восстановление без траты ячейки заклинания и/или материального компонента. Вы не можете получить эти чары снова, пока они у вас есть.'
      },
      {
        name: 'Собирать: талисманы',
        description: 'Когда вы отдаёте приказ собирать этому сооружению, вы поручаете его наёмнику изготовить специально подготовленный талисман для вашего использования. Талисман обычно принимает форму амулета, шкатулки с рунами или статуэтки, но это может быть любой крошечный немагический предмет, имеющий религиозное значение. Работа занимает 7 дней и не стоит денег. Вы можете применить этот талисман вместо материальных компонентов одного заклинания, при условии, что компоненты имеют стоимость 1000 зм или меньше. После того, как талисман был применён таким образом, его нельзя использовать снова, пока вы не вернёте его в свой реликварий и не используете другой приказ собирать для его подготовки.'
      }
    ]
  },
  {
    name: 'Трактир',
    nameEn: 'Pub',
    level: 13,
    requirements: 'Нет',
    space: 4,
    hirelings: 1,
    order: 6,
    description: 'Сюда приходят, чтобы наслаждаться хорошими напитками и общением. Ваш трактир может быть баром, кофейней или чайной комнатой, и у него может быть красочное название, например, «Пивоварня Дерика» или «Драконий чердак». Наёмник заведения, который работает барменом, поддерживает сеть шпионов из близлежащих общин. Эти шпионы являются полезными источниками информации и часто посещают трактир, часто инкогнито.',
    abilities: [
      {
        name: 'Изучать: сбор информации',
        description: 'Когда вы отдаёте приказ изучать этому сооружению, вы поручаете бармену трактира собрать информацию от шпионов, которые знают обо всех важных событиях, происходящих в радиусе 10 миль (16 километров) от вашего бастиона в течение следующих 7 дней. В течение этого времени эти шпионы могут сообщить местоположение любого существа, которое вам знакомо, при условии, что существо находится в радиусе 50 миль (80,5 километров) от вашего бастиона и не скрыто магией или не ограничено местоположением, которое Мастер считает находящимся за пределами возможностей шпионской сети. Если шпионы узнают местоположение цели, они также узнают, где это существо находилось в течение предыдущих 7 дней.'
      },
      {
        name: 'Спецпредложение трактира',
        description: 'В трактире всегда есть один волшебный напиток на разлив, выбранный из списка ниже:'
      },
      {
        name: 'Бремя Бигби',
        description: 'Пинта этого напитка даёт вам эффект увеличения из заклинания Увеличение/Уменьшение на 24 часа (спасбросок не требуется).'
      },
      {
        name: 'Поцелуй королевы Пауков',
        description: 'Пинта этого напитка даёт вам эффект заклинания Паук на 24 часа.'
      },
      {
        name: 'Серенада Луносвета',
        description: 'Пинта этого напитка даёт вам тёмное зрение в пределах 60 футов на 24 часа. Если у вас уже есть тёмное зрение, то его дальность увеличивается на 60 футов на тот же срок.'
      },
      {
        name: 'Позитивное подкрепление',
        description: 'Пинта этого напитка даёт вам сопротивление урону некротической энергией на 24 часа.'
      },
      {
        name: 'Крепкий стержень',
        description: 'В течение 24 часов после того, как вы выпили пинту этого напитка, вы автоматически преуспеваете в спасбросках, чтобы избежать или прекратить состояние испуганный'
      },
      {
        name: '',
        description: 'В начале хода бастиона вы можете сменить напиток на один из других в списке. Мастер может придумать новые варианты. Пинта этого магического напитка теряет свои волшебные свойства через 24 часа после разлива'
      },
      {
        name: 'Расширение заведения',
        description: 'Вы можете расширить трактир до просторного за 2000 зм. В этом случае в трактире могут быть на разлив одновременно 2 напитка из списка «Спецпредложение трактира». Просторный трактир нанимает 3 дополнительных наёмников — всего их становится 4. Эти новые наёмники — официанты. Придумайте им имена и характеры по своему усмотрению.'
      }
    ]
  },
  {
    name: 'Гильдия',
    nameEn: 'Guildhall',
    level: 17,
    requirements: 'Компетентность в любом навыке',
    space: 3,
    hirelings: 1,
    order: 5,
    description: 'Гильдия поставляется с организацией, в которой вы являетесь гильдмастером. Выберите тип гильдии из вариантов в таблице «Типы гильдии» или проработайте с вашим Мастером новую гильдию. Сооружение представляет собой комнату для собраний, где члены вашей гильдии могут обсуждать важные вопросы в вашем присутствии. Ваша гильдия насчитывает около 50 членов, состоящих из квалифицированных специалистов, которые живут и работают за пределами вашего бастиона, обычно в близлежащих поселениях.',
    abilities: [
      {
        name: 'Завербовать: на задание от гильдии',
        description: 'Каждый раз, когда вы отдаёте приказ завербовать этому сооружению, вы поручаете наёмнику сооружения набрать членов гильдии для выполнения особого задания. Каждая гильдия в таблице «Типы гильдии» определяет характер этого задания. С разрешения и с помощью вашего Мастера вы можете создавать новые задания для членов гильдии.'
      }
    ]
  },
  {
    name: 'Военный штаб',
    nameEn: 'War Room',
    level: 17,
    requirements: 'Умение Боевой стиль или Защита без доспехов',
    space: 3,
    hirelings: 2,
    order: 5,
    description: 'Военный штаб — это место, где вы планируете военные действия, консультируясь с узким кругом верных лейтенантов, каждый из которых — закалённый в боях ветеран воин (см. Бестиарий), чьё мировоззрение соответствует вашему. Вы начинаете с двумя лейтенантами, но можете рекрутировать дополнительных, как описано ниже. Если в вашем бастионе нет помещений для размещения ваших лейтенантов, то они размещаются в ближайшей к бастиону гостинице или поселении. Лейтенанты — наёмники, а не защитники бастиона; однако, если ваш бастион подвергается нападению (см. События бастиона в конце этой главы), каждый лейтенант, размещённый в вашем бастионе, уменьшает на 1 количество костей, которые вы бросаете для определения количества потерянных защитников бастиона в результате атаки. В военном штабе хранятся военные памятные вещи, а также большой стол с достаточным количеством стульев для вас и ваших лейтенантов.',
    abilities: [
      {
        name: 'Варианты вербовки',
        description: 'Когда вы отдаёте приказ завербовать этому сооружению, выберите один из следующих вариантов:'
      },
      {
        name: 'Завербовать: лейтенанта',
        description: 'Вы получаете одного нового лейтенанта. Вы можете иметь до 10 лейтенантов в любое время. Дайте им имена и личности по своему усмотрению.'
      },
      {
        name: 'Завербовать: солдат',
        description: 'Вы поручите одному или нескольким своим лейтенантам собрать небольшую армию. Каждый лейтенант может собрать 100 стражников (см. Бестиарий) за 7 дней, чтобы сражаться за ваше дело. Сократите это число до 20, если вы хотите, чтобы они были верхом на ездовых лошадях (см. Бестиарий). Кормление каждого стражника и каждой лошади в вашей армии стоит вам 1 зм в день. Куда бы ни пошла армия, её должны возглавлять вы или по крайней мере 1 из ваших лейтенантов, иначе она немедленно расформируется. Армия также расформировывается, если её не кормили в течение 1 дня. В противном случае армия остаётся, пока её не уничтожат или вы не прикажете ей расформироваться. Вы не можете отдать этот приказ о вербовке снова, пока ваша текущая армия не расформируется или не будет уничтожена.'
      }
    ]
  },
  {
    name: 'Демиплан',
    nameEn: 'Demiplane',
    level: 17,
    requirements: 'Умение использовать заклинательную фокусировку или инструмент в качестве неё',
    space: 3,
    hirelings: 1,
    order: 2,
    description: 'Дверь шириной до 5 футов и высотой до 10 футов появляется на плоской, твёрдой поверхности в одном из других сооружений в вашем бастионе. Вы выбираете местоположение. Если вы находитесь в своём бастионе во время хода бастиона, то вы можете переместить эту дверь в другое сооружение в вашем бастионе.Только вы и наёмники вашего бастиона можете открыть дверь, которая ведёт в демиплан, который принимает форму каменной комнаты. Демиплан существует в межпространстве и, следовательно, не соседствует физически с другими местами в вашем бастионе. Ни демиплан, ни его дверь не могут быть развеяны.',
    abilities: [
      {
        name: 'Усилить: мистическую устойчивость',
        description: 'Когда вы отдаёте приказ усилить этому сооружению, на стенах демиплана появляются магические руны, которые сохраняются в течение 7 дней. После проведения продолжительного отдыха в демиплане и пока руны не исчезнут, вы получаете временные хиты, равные вашему пятикратному уровню.'
      },
      {
        name: 'Изготовление',
        description: 'Находясь в демиплане, вы можете совершить действие магия, чтобы создать немагический объект по вашему выбору из ничего, заставив его появиться в незанятом пространстве в демиплане. Объект не может быть больше 5 футов в любом измерении; не может иметь ценность более 5 зм; и должен быть сделан из дерева, камня, глины, фарфора, стекла, бумаги, недрагоценного кристалла или недрагоценного металла. Вы должны завершить продолжительный отдых, прежде чем сможете совершить это действие снова.'
      }
    ]
  },
  {
    name: 'Храм',
    nameEn: 'Sanctum',
    level: 17,
    requirements: 'Умение использовать священный символ или фокусировку друида в качестве заклинательной фокусировки',
    space: 2,
    hirelings: 1,
    order: 2,
    description: 'Храм — это место утешения и исцеления.',
    abilities: [
      {
        name: 'Чары храма',
        description: 'Проведя продолжительный отдых в своём бастионе, вы получаете магические чары (см. Сверхъестественные дары в главе 3), которые действуют в течение 7 дней или пока вы их не используете. Чары позволяют вам 1 раз наложить заклинание Исцеление без траты ячейки заклинания. Вы не можете получить эти чары снова, пока они у вас есть.'
      },
      {
        name: 'Усилить: укрепляющие обряды',
        description: 'Когда вы отдаёте приказ усилить этому сооружению, вы вдохновляете его наёмников выполнять ежедневные обряды, которые приносят пользу вам или другому персонажу, которого вы укажете. Получателю не обязательно находиться в бастионе, когда проводятся обряды, чтобы получить их эффект. Каждый раз, когда получатель заканчивает продолжительный отдых, он получает временные хиты, равные вашему уровню. Этот эффект длится 7 дней.'
      },
      {
        name: 'Возврат в храм',
        description: 'Пока существует храм, у вас всегда есть заклинание Слово возврата. Когда вы накладываете заклинание Слово возврата, вы можете сделать свой храм местом назначения заклинания вместо другого места, которое вы ранее обозначили. Кроме того, одно существо по вашему выбору, которое прибывает в храм с помощью этого заклинания, получает эффект заклинания Исцеление.'
      }
    ]
  }
];

const events = {
  title: 'События бастиона',
  table: [
    { roll: '01-50', event: 'Всё хорошо' },
    { roll: '51-55', event: 'Атака' },
    { roll: '56-58', event: 'Наёмник оказался преступником' },
    { roll: '59-63', event: 'Удачный случай' },
    { roll: '64-72', event: 'Дружелюбные посетители' },
    { roll: '73-76', event: 'Гость' },
    { roll: '77-79', event: 'Пропавшие наёмники' },
    { roll: '80-83', event: 'Волшебное открытие' },
    { roll: '84-91', event: 'Беженцы' },
    { roll: '92-98', event: 'Просьба о помощи' },
    { roll: '99-00', event: 'Сокровище' }
  ]
};
---

<Layout title="Бастионы">
  <div class="content">
    <h1>Бастионы</h1>
    
      <div id="filter-panel" class="filter-panel">
        <div class="filter-content">
          <div class="filter-group">
            <h4>Требуемый уровень</h4>
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" name="level" value="5" />
                5 уровень
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="level" value="9" />
                9 уровень
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="level" value="13" />
                13 уровень
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="level" value="17" />
                17 уровень
              </label>
            </div>
          </div>

          <div class="filter-group">
            <h4>Требования</h4>
            <div class="checkbox-group" id="requirements-filters">
              <label class="checkbox-label">
                <input type="checkbox" name="requirement" value="none" />
                Нет требований
              </label>
              <!-- Dynamic requirements will be added by JavaScript -->
            </div>
          </div>

          <div class="filter-actions">
            <button id="reset-filters" class="reset-button">Сбросить фильтры</button>
          </div>
        </div>
      </div>

    <div class="bastions-container">
      <BastionRules />
      <BastionUsage />
      <h2>Постройки</h2>
      <section class="buildings-section">
        <div class="filter-controls">
          <button id="filter-toggle" class="filter-button">
            <span class="filter-icon">⚙</span>
            Фильтр
            <span id="active-filters" class="filter-count">0</span>
          </button>
        </div>
        <div class="buildings-grid" id="buildings-grid">
          {buildings.map(building => (
            <div class="building-tile" 
              data-level={building.level || 13} 
              data-requirements={building.requirements}>
              <div class="building-header">
                <div class="building-info">
                  <h3 class="building-name">{building.name}</h3>
                  <div class="building-name-en">[{building.nameEn}]</div>
                </div>
                <div class="building-level">{building.level || 13}</div>
              </div>
              <button class="expand-button" data-building={building.name}>+</button>
              
              <div class="building-details" style="display: none;">
                <div class="details-header">
                  <h3>{building.name} <span class="name-en">[{building.nameEn}]</span></h3>
                  <button class="collapse-button">-</button>
                </div>
                <div class="building-type">Уровень {building.level || 13}, сооружение бастиона</div>
                
                <div class="building-meta">
                  <div class="meta-row">
                    <span class="meta-label">Требования:</span>
                    <span class="meta-value">{building.requirements}</span>
                  </div>
                  <div class="meta-row">
                    <span class="meta-label">Пространство:</span>
                    <span class="meta-value">{
                      building.space === 1 ? 'Тесное (4 квадрата)' :
                      building.space === 2 ? 'Вместительное (16 квадратов)' :
                      building.space === 3 ? 'Просторное (36 квадратов)' :
                      'Вместительное (16 кв), просторное (36 кв)'
                    }</span>
                  </div>
                  <div class="meta-row">
                    <span class="meta-label">Наёмники:</span>
                    <span class="meta-value">{building.hirelings}</span>
                  </div>
                  <div class="meta-row">
                    <span class="meta-label">Приказ:</span>
                    <span class="meta-value">{
                      building.order === 1 ? 'Изготовить' :
                      building.order === 2 ? 'Усилить' :
                      building.order === 3 ? 'Собрать' :
                      building.order === 4 ? 'Обслуживать' :
                      building.order === 5 ? 'Завербовать' :
                      building.order === 6 ? 'Изучать' :
                      'Торговать'
                    }</span>
                  </div>
                </div>

                <div class="building-description">
                  <p>{building.description}</p>
                </div>

                <div class="building-abilities">
                  {building.abilities.map(ability => (
                    <div class="ability">
                      <p><strong>{ability.name}.</strong> {ability.description}</p>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          ))}
        </div>
      </section>

      <BastionEvents events={events} />
    </div>
  </div>
</Layout>

<script define:vars={{ buildings }}>
  document.addEventListener('DOMContentLoaded', () => {
    const filterToggle = document.getElementById('filter-toggle');
    const filterPanel = document.getElementById('filter-panel');
    const resetFilters = document.getElementById('reset-filters');
    const activeFiltersCount = document.getElementById('active-filters');
    const buildingsGrid = document.getElementById('buildings-grid');
    const buildingTiles = document.querySelectorAll('.building-tile');

    // Initialize dynamic requirements filter
    function initializeRequirementsFilter() {
      const requirementsSet = new Set();
      buildings.forEach(building => {
        if (building.requirements && building.requirements !== 'Нет') {
          requirementsSet.add(building.requirements);
        }
      });

      const requirementsFilter = document.getElementById('requirements-filters');
      Array.from(requirementsSet).forEach(requirement => {
        const label = document.createElement('label');
        label.className = 'checkbox-label';
        label.innerHTML = `
          <input type="checkbox" name="requirement" value="${requirement}" />
          ${requirement}
        `;
        requirementsFilter.appendChild(label);
      });
    }

    // Filter functionality
    function applyFilters() {
      const selectedLevels = Array.from(document.querySelectorAll('input[name="level"]:checked'))
        .map(cb => parseInt(cb.value));
      const selectedRequirements = Array.from(document.querySelectorAll('input[name="requirement"]:checked'))
        .map(cb => cb.value);

      let visibleCount = 0;

      buildingTiles.forEach(tile => {
        const level = parseInt(tile.dataset.level);
        const requirements = tile.dataset.requirements;
        
        const matchesLevel = selectedLevels.length === 0 || selectedLevels.includes(level);
        const matchesRequirements = selectedRequirements.length === 0 || 
          selectedRequirements.includes('none') && (!requirements || requirements === 'Нет') ||
          selectedRequirements.includes(requirements);

        const isVisible = matchesLevel && matchesRequirements;
        tile.style.display = isVisible ? 'block' : 'none';
        
        if (isVisible) visibleCount++;
      });

      updateFilterCount();
    }

    function updateFilterCount() {
      const activeFilters = document.querySelectorAll('input[type="checkbox"]:checked').length;
      activeFiltersCount.textContent = activeFilters.toString();
      activeFiltersCount.style.display = activeFilters > 0 ? 'flex' : 'none';
      filterToggle.classList.toggle('has-filters', activeFilters > 0);
    }

    // Event listeners
    filterToggle?.addEventListener('click', () => {
      filterPanel.classList.toggle('show');
    });

    resetFilters?.addEventListener('click', () => {
      document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        cb.checked = false;
      });
      applyFilters();
    });

    // Filter change events
    document.addEventListener('change', (e) => {
      if (e.target.type === 'checkbox') {
        applyFilters();
      }
    });

    // Building expansion functionality
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('expand-button')) {
        const tile = e.target.closest('.building-tile');
        const details = tile.querySelector('.building-details');
        const expandButton = e.target;
        
        details.style.display = 'block';
        expandButton.style.display = 'none';
        
        // Smooth transition
        details.style.opacity = '0';
        details.style.transform = 'translateY(-10px)';
        
        requestAnimationFrame(() => {
          details.style.transition = 'all 0.3s ease';
          details.style.opacity = '1';
          details.style.transform = 'translateY(0)';
        });
      }
      
      if (e.target.classList.contains('collapse-button')) {
        const tile = e.target.closest('.building-tile');
        const details = tile.querySelector('.building-details');
        const expandButton = tile.querySelector('.expand-button');
        
        details.style.transition = 'all 0.3s ease';
        details.style.opacity = '0';
        details.style.transform = 'translateY(-10px)';
        
        setTimeout(() => {
          details.style.display = 'none';
          expandButton.style.display = 'flex';
        }, 300);
      }
    });

    // Close filter panel when clicking outside
    document.addEventListener('click', (e) => {
      if (!filterPanel.contains(e.target) && !filterToggle.contains(e.target)) {
        filterPanel.classList.remove('show');
      }
    });

    // Initialize
    initializeRequirementsFilter();
    applyFilters();
  });
</script>

<style>
  .content {
    max-width: 800px;
    margin: 0 auto;
  }

  .bastions-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .buildings-section {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 0.5rem;
    box-shadow: var(--card-shadow);
    border: 1px solid var(--card-border);
  }

  .filter-controls {
    margin-bottom: 1.5rem;
    display: flex;
    justify-content: flex-end;
  }

  .filter-button {
    position: relative;
    padding: 0.75rem 1rem;
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 0.5rem;
    color: var(--text);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.2s;
  }

  .filter-button:hover {
    background: var(--nav-hover-bg);
  }

  .filter-button.has-filters {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }

  .filter-icon {
    font-size: 1.2rem;
  }

  .filter-count {
    position: absolute;
    top: -8px;
    right: -8px;
    background: #ef4444;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .filter-panel {
    display: none;
    position: absolute;
    top: 100%;
    right: 0;
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 0.5rem;
    box-shadow: var(--card-shadow);
    min-width: 300px;
    z-index: 100;
    margin-top: 0.5rem;
  }

  .filter-panel.show {
    display: block;
  }

  .filter-content {
    padding: 1.5rem;
  }

  .filter-group {
    margin-bottom: 1.5rem;
  }

  .filter-group:last-of-type {
    margin-bottom: 2rem;
  }

  .filter-group h4 {
    color: var(--primary);
    margin-bottom: 0.75rem;
    font-size: 1rem;
  }

  .checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 0.25rem;
  }

  .checkbox-label:hover {
    background: var(--nav-hover-bg);
  }

  .filter-actions {
    display: flex;
    justify-content: center;
    padding-top: 1rem;
    border-top: 1px solid var(--card-border);
  }

  .reset-button {
    padding: 0.75rem 1.5rem;
    background: var(--background);
    border: 1px solid var(--card-border);
    border-radius: 0.5rem;
    color: var(--text);
    cursor: pointer;
    transition: all 0.2s;
  }

  .reset-button:hover {
    background: var(--nav-hover-bg);
  }

  .buildings-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    margin-top: 1rem;
  }

  .building-tile {
    position: relative;
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 0.5rem;
    padding: 1.5rem;
    box-shadow: var(--card-shadow);
    transition: all 0.3s ease;
    min-height: 120px;
  }

  .building-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
  }

  .building-info {
    flex: 1;
  }

  .building-name {
    margin: 0;
    color: var(--primary);
    font-size: 1.25rem;
    line-height: 1.2;
  }

  .building-name-en {
    color: var(--text);
    opacity: 0.7;
    font-size: 0.9em;
    margin-top: 0.25rem;
  }

  .building-level {
    background: var(--primary);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    font-weight: 600;
  }

  .expand-button,
  .collapse-button {
    position: absolute;
    bottom: 1rem;
    right: 1.5rem;
    width: 2rem;
    height: 2rem;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    font-weight: bold;
    transition: all 0.2s;
    z-index: 10;
  }

  .expand-button:hover,
  .collapse-button:hover {
    background: var(--primary-dark);
    transform: scale(1.1);
  }

  .collapse-button {
    position: absolute;
    top: 1rem;
    right: 10%;
  }

  .building-details {
    position: absolute; /*absolute*/
    top: 30%;
    transform: translate(-50%, -50%);
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 0.5rem;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    min-width: 400px;
    max-height: 600px;
    overflow-y: auto;
    z-index: 1000;
    padding: 1.5rem;
  }

  .details-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--card-border);
  }

  .details-header h3 {
    margin: 0;
    color: var(--primary);
    flex: 1;
  }

  .name-en {
    color: var(--text);
    opacity: 0.7;
    font-size: 0.8em;
  }

  .building-type {
    margin-bottom: 1rem;
    color: var(--text);
    opacity: 0.8;
    font-style: italic;
  }

  .building-meta {
    margin-bottom: 1rem;
  }

  .meta-row {
    display: flex;
    margin-bottom: 0.5rem;
  }

  .meta-label {
    font-weight: 600;
    color: var(--primary);
    min-width: 120px;
    flex-shrink: 0;
  }

  .meta-value {
    flex: 1;
  }

  .building-description {
    margin-bottom: 1rem;
    line-height: 1.6;
  }

  .building-description p {
    margin: 0;
  }

  .building-abilities {
    border-top: 1px solid var(--card-border);
    padding-top: 1rem;
  }

  .ability {
    margin-bottom: 1rem;
  }

  .ability:last-child {
    margin-bottom: 0;
  }

  .ability p {
    margin: 0;
    line-height: 1.6;
  }

  .ability strong {
    color: var(--primary);
  }

  /* Responsive design */
  @media (max-width: 1024px) {
    .buildings-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .buildings-grid {
      grid-template-columns: 1fr;
    }
    
    .building-details {
      max-width: 90vw;
      max-height: 90vh;
      padding: 1.5rem;
    }
    
    .filter-panel {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      right: auto;
      min-width: 90vw;
    }
  }

  h2 {
    color: var(--primary);
    margin-bottom: 1rem;
  }
</style>